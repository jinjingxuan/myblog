# 北大肖臻老师《区块链技术与应用》公开课学习 7
* 学习地址：[https://www.bilibili.com/video/BV1Vt411X7JF](https://www.bilibili.com/video/BV1Vt411X7JF)
* 参考文章：[北京大学肖臻老师《区块链技术与应用》公开课笔记24——ETH权益证明篇](https://blog.nowcoder.net/n/a509ac93c75242438e71cb47fe59229c)

## 权益证明

比特币的挖矿过程，消耗了巨大的电力，并且能耗随时间不断增长，平均每一个交易消耗 `1000` 度电。同样地以太坊平均每一个交易消耗 `67` 度电。

> 矿工为什么要挖矿？因为要获得出块奖励。为什么要给矿工奖励？因为激励矿工参与区块链的维护。
> 挖矿的收益是由『拼钱』（买矿机）决定的，那么既然是拼钱，我们直接把钱拿出来比一比行不行？与其买矿机挖矿，我们不如把钱投入到区块链的维护当中，由投入资金的比例来决定最终的收益。这就是 `proof of stake` 权益证明的思想。

优点：
* 省去了挖矿的过程，减少了能耗，减少了温室气体的排放。
* 维护区块链安全的资源形成闭环，而 POW 中维护其安全的资源需要通过现实中流通的货币购买矿机等设备，这也就导致只要有人想要攻击，只需要外部聚集足够资金达到 51% 算力就可以攻击成功。主流的货币抗攻击能力还比较强，刚刚发行的小币种，遇到这种攻击是致命的。`Altcoin Infanticide`。

权益证明是基于拥有的币，如果想发动攻击必须获取一半以上的币，无论你在外部有多少的资金，都不会对加密货币系统造成直接的影响，你只能花钱买到足够多的币才可以（内部闭环），如果一旦有人花钱大量买币，会导致价格大涨，这对开发者是有好处的可以大赚一笔。

### 两边下注
假如一个区块链出现了分叉，如果挖矿会沿着最长合法链去挖，虽然另一条也有可能成为最长合法链，但是你只会沿着一条去挖。但是如果是权益证明，你可以两边都下注。

### 以太坊权益证明
`Casper the Friendly Finality Gadget(FFG)`

`Casper` 协议引入一个概念 `validator` 验证者，想成为 `validator` 必须投入一定的保证金，保证金会被系统锁定。他的职责是推动系统达成共识，投票决定哪条链成为最长合法链，投票的权重为保证金的数目。第一轮投票是 `prepare message`，第二轮投票是 `commit message`，每一轮投票都要得到 `2/3` 以上的验证者同意。实际上 `100` 个区块的 `epoch` 分成两个 `50` 个区块，每 `50` 个区块结束后就进行一轮投票。

> 矿工挖矿会获得出块奖励，而验证者也会得到相应奖励。当然某个验证者行政不作为，不参与投票导致系统迟迟无法达成共识，这时扣掉部分保证金；如果某个验证者乱作为，给两边都进行投票，被发现后没收全部保证金。没收后的保证金直接销毁掉。
> 每个验证者有一定时间的任期，在任期结束后，进入等待期，在此期间等待其他节点检举揭发是否存在不良行为，若通过等待期，则可以取回保证金并获得一定奖励。

通过验证者投票达成的 `Finality`，有没有可能被推翻？
> 假如某个恶意的组织要发生攻击，假如他们是矿工的话，没有验证者作为同伙则无法推翻 `Finality`。矿工无论算力多么强，最终投票权都不在其手中。
> 必须在系统中，存在大量验证者进行了两边投票，也就是说，至少 `1/3`（该协议规定超过2/3才有效）的验证者两侧都投票，才会导致系统被篡改。而这一旦被发现，这 `1/3` 验证者的保证金将会被没收。

**以太坊系统设想，随着时间推移，挖矿奖励逐渐减少而权益证明奖励逐渐增多，从而实现POW到POS的过渡，最终实现完全放弃挖矿。**

既然权益证明这么好，那么为什么没有推广开来？
> 比特币和以太坊的机制都经过了 `bug bounty`，工作量证明已经得到了事实检验，该机制较为成熟。
> 例如 `EOS` 柚子加密货币，它用的就是权益证明的思想，用的是 `DPOS：Delegated Proof of Stake` 协议，通过投票选 21 个超级节点，再由超级节点产生区块。基于权益证明的机制仍然处于探索阶段。

有人认为挖矿消耗的电并不是很多，而且其对于环境的影响是有限的。很多人对工作量证明其实是反感做的是无用功。挖矿提供了将电能转换为钱的手段，而电能本身难以传输和存储。挖矿为将多余的电能转换为有价值的货币提供了很好的解决手段。也就是说挖矿消耗电能可以有效消耗过剩产能，带动当地经济发展。