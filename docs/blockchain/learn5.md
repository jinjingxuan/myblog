# 北大肖臻老师《区块链技术与应用》公开课学习 5
* 学习地址：[https://www.bilibili.com/video/BV1Vt411X7JF](https://www.bilibili.com/video/BV1Vt411X7JF)
* 参考文章：[北京大学肖臻老师《区块链技术与应用》公开课笔记15——ETH概述篇](https://blog.nowcoder.net/n/f6a89f59329542eb9216caa8ca2c843d)

## ETH 概述
`BTC` 和 `ETH` 为最主要的两种加密货币，`BTC` 称为区块链 `1.0`，以太坊称为区块链 `2.0`。因为了比特币设计中存在某些不足，以太坊便对其进行了改进。例如：
* 出块时间: 以太坊出块时间降低到十几秒，以及设计了一套共识协议
* `mining puzzle`: `BTC` 挖矿属于计算密集型，挖矿设备专业化（ASIC），以太坊设计的 `mining puzzle` 对内存要求高，限制了 `ASIC` 的使用（ASIC resistance）
* 未来，以太坊还将会用权益证明(proof of stake)替代工作量证明(proof of work)
* 此外，以太坊增加了对智能合约（smart contract）的支持。

### 为什么智能合约
`BTC` 本身是一个去中心化的货币，在比特币取得成功之后，很多人就开始思考：除了货币可以去中心化，还有什么可以去中心化？以太坊的一个特性就是增加了对去中心化的合约的支持。
* BitCoin: decenralized currency, BTC, 最小单位一聪
* Ethereum: decenralized contract, ETH, 最小单位一`wei`

货币本身由政府发行，政府公信力为其背书，`BTC` 通过技术手段取代了政府的职能。
现实生活中，我们经常提到 `契约` 或 `合约`。合约的有效性也是需要政府进行维护的，如果产生纠纷需要针对合法性合同进行判决（打官司）。`ETH` 的设计目的就是，通过技术手段来实现取代政府对于合约的职能（区块链的不可篡改性）。并不是所有的合同都可以实现，比较简单的可以使用智能合约。

智能合约有什么好处？
> 去中心化的货币的好处是跨国转账，比法币快很多。
> 智能合约: 若合同签署方并非一个国家，没有统一的司法部门。如果可以编写无法修改的合约，所有人只能按照相关参与方执行，无法违约。

## ETH 账户
`BTC` 系统是基于交易的账本，系统中并未显示记录账户有多少钱，只能通过 `UTXO` 进行推算。这种隐私保护比较好，但是使用起来比较别扭。比如 `A` 转给 `B` 比特币的时候，`A` 需要说明币的来源。但是我们实际中存钱说明来源，花钱则不用。此外，`BTC` 账户中的钱在花的时候，必须一次性全部花出去。

> A => B(10BTC)   B => C(3BTC)
> 如果 B 只转给 C 3个 BTC，那么剩下的 7个 BTC 将作为交易费给矿工，所以还要将剩下的钱转给自己：B => B'(7 BTC)
> 比特币系统中没有显式的基于账户的模型
> 而以太坊系统则采用了基于账户的模型，与现实中银行账户相似。

优点：转账是否合法只需要查看转账者账户中以太币是否足够即可，同时也不需要每次全部转账，这也天然地防范了双花攻击。（你要是花两次我就从你账户扣两次钱）
缺点：重放攻击：`A` 向 `B` 转账，过一段时间，`B` 将 `A` 的交易重新发布，从而导致 `A`账户被扣钱两次。

> 为了防范重放攻击，给账户交易添加计数器记录该账户交易过多少次，转账时候将转账次数计入交易的内容中。
> 系统中全节点维护账户余额和该计数器的交易数，从而防止本地篡改余额或进行重放攻击。
> 交易内容：A => B(10ETH)、nonce = 21(这是第21次交易)、Signed by A
> 如果重放上述交易内容，会发现 nonce = 21 的交易已经被发布了，就不会执行了。

以太坊系统中存在两类账户：外部账户和合约账户。

* 外部账户：类似于 `BTC` 系统中公私钥对。存在账户余额 `balance` 和计数器 `nonce`
* 合约账户：并非通过公私钥对控制。合约账户不能主动发起交易，只能接收到外部账户调用后才能发起交易或调用其他合约账户。其除了`balance` 和 `nonce` 之外还有 `code` (代码)、`storage` (相关状态-存储)

创建合约时候会返回一个地址，就可以对其调用。调用过程中，代码不变但状态会发生改变。

### 为什么以太坊要基于账户的模型
比特币隐私保护比较好，支持每次交易都更换账户。但以太坊是为了支持智能合约，而合约签订双方是比较稳定的身份且较少变化的。尤其是对于合约账户来说，需要保持稳定状态。